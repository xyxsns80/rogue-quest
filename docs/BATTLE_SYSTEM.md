# æˆ˜æ–—ç³»ç»Ÿè®¾è®¡æ–‡æ¡£

## 1. æ¦‚è¿°

### 1.1 è®¾è®¡ç›®æ ‡
- **èŠ‚å¥ï¼š** 3-5åˆ†é’Ÿ/å±€ï¼Œä¸­å¿«èŠ‚å¥
- **æ“ä½œï¼š** å¯è‡ªåŠ¨å¯æ‰‹åŠ¨ï¼Œè½»æ¾æŒ‚æœº
- **ä¹è¶£ï¼š** è‚‰é¸½å…ƒç´ å¸¦æ¥çš„ç­–ç•¥é€‰æ‹©

### 1.2 æ ¸å¿ƒå¾ªç¯
```
è¿›å…¥æˆ˜æ–— â†’ è‡ªåŠ¨æˆ˜æ–— â†’ å‡»æ€æ•Œäºº â†’ è·å¾—ç»éªŒ â†’ å‡çº§ â†’ é€‰æ‹©æŠ€èƒ½ â†’ ç»§ç»­æˆ˜æ–— â†’ é€šå…³/å¤±è´¥ â†’ ç»“ç®—
```

---

## 2. æˆ˜æ–—æµç¨‹

### 2.1 æˆ˜æ–—çŠ¶æ€æœº

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     æˆ˜æ–—æµç¨‹çŠ¶æ€å›¾                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    [å¼€å§‹]
       â”‚
       â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ åˆå§‹åŒ–   â”‚ â† ç”Ÿæˆæ•Œäººã€é‡ç½®çŠ¶æ€ã€æ˜¾ç¤ºUI
  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
       â”‚
       â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ æˆ˜æ–—ä¸­   â”‚ â† è‡ªåŠ¨/æ‰‹åŠ¨æ”»å‡»å¾ªç¯
  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€ æ•Œäººå…¨ç­ â”€â”€â†’ [èƒœåˆ©] â†’ ä¸‹ä¸€å…³
       â”‚
       â”œâ”€â”€ HPå½’é›¶ â”€â”€â”€â”€â†’ [å¤±è´¥] â†’ ç»“ç®—
       â”‚
       â””â”€â”€ è·å¾—è¶³å¤Ÿç»éªŒ â†’ [å‡çº§] â†’ é€‰æ‹©æŠ€èƒ½ â†’ ç»§ç»­æˆ˜æ–—
```

### 2.2 æˆ˜æ–—å›åˆï¼ˆæ¯ç§’ï¼‰

```typescript
interface BattleTick {
  // 1. æ£€æŸ¥çŠ¶æ€
  if (isPaused) return;  // æš‚åœä¸­ï¼ˆæŠ€èƒ½é€‰æ‹©ç­‰ï¼‰
  if (heroHp <= 0) â†’ å¤±è´¥;
  if (enemies.length === 0) â†’ èƒœåˆ©;
  
  // 2. è‹±é›„è¡ŒåŠ¨
  if (isAutoMode) {
    heroAttack();      // æ™®æ”»
    autoUseSkills();   // æŠ€èƒ½
  }
  
  // 3. æ•Œäººè¡ŒåŠ¨
  enemies.forEach(enemy => enemyAttack());
  
  // 4. æ›´æ–°å†·å´
  updateSkillCooldowns();
  
  // 5. æ›´æ–°UI
  updateBattleUI();
}
```

---

## 3. å±æ€§ç³»ç»Ÿ

### 3.1 è‹±é›„å±æ€§

```typescript
interface HeroStats {
  // åŸºç¡€å±æ€§
  hp: number;           // ç”Ÿå‘½å€¼
  maxHp: number;        // æœ€å¤§ç”Ÿå‘½å€¼
  attack: number;       // æ”»å‡»åŠ›
  defense: number;      // é˜²å¾¡åŠ›
  speed: number;        // æ”»å‡»é€Ÿåº¦ï¼ˆæ¯ç§’æ”»å‡»æ¬¡æ•°ï¼‰
  critRate: number;     // æš´å‡»ç‡ï¼ˆ0-1ï¼‰
  critDamage: number;   // æš´å‡»ä¼¤å®³å€ç‡ï¼ˆé»˜è®¤2.0ï¼‰
  
  // ç‰¹æ®Šå±æ€§
  lifesteal: number;    // ç”Ÿå‘½å·å–ï¼ˆ0-1ï¼‰
  dodgeRate: number;    // é—ªé¿ç‡ï¼ˆ0-1ï¼‰
  
  // è®¡ç®—å…¬å¼
  actualDamage = attack * skillMultiplier * (isCrit ? critDamage : 1);
  actualHeal = lifesteal * actualDamage;
}
```

### 3.2 æ•Œäººå±æ€§

```typescript
interface EnemyStats {
  hp: number;           // ç”Ÿå‘½å€¼
  maxHp: number;        // æœ€å¤§ç”Ÿå‘½å€¼
  attack: number;       // æ”»å‡»åŠ›
  
  // æ ¹æ®å…³å¡è®¡ç®—
  baseHp = 50 + level * 10;
  baseAttack = 5 + level * 2;
  count = Math.min(1 + Math.floor(level / 2), 5);
}
```

---

## 4. æŠ€èƒ½ç³»ç»Ÿ

### 4.1 æŠ€èƒ½ç±»å‹

```typescript
type SkillType = 
  | 'active'    // ä¸»åŠ¨æŠ€èƒ½ï¼ˆCDåˆ¶ï¼‰
  | 'passive'   // è¢«åŠ¨æŠ€èƒ½ï¼ˆæ¦‚ç‡è§¦å‘ï¼‰
  | 'toggle';   // å¼€å…³æŠ€èƒ½ï¼ˆå¯å¼€å…³ï¼‰

interface Skill {
  id: string;
  name: string;
  icon: string;
  type: SkillType;
  description: string;
  
  // ä¸»åŠ¨æŠ€èƒ½
  cooldown?: number;      // å†·å´æ—¶é—´ï¼ˆç§’ï¼‰
  currentCooldown?: number;
  
  // è¢«åŠ¨æŠ€èƒ½
  triggerChance?: number; // è§¦å‘æ¦‚ç‡
  
  // æ•ˆæœ
  damageMultiplier?: number;  // ä¼¤å®³å€ç‡
  healPercent?: number;       // å›å¤ç™¾åˆ†æ¯”
  buffs?: Buff[];             // å¢ç›Šæ•ˆæœ
}
```

### 4.2 åˆå§‹æŠ€èƒ½

| æŠ€èƒ½ | ç±»å‹ | æ•ˆæœ | å†·å´ |
|------|------|------|------|
| æ™®æ”» | è¢«åŠ¨ | åŸºç¡€æ”»å‡»åŠ›ä¼¤å®³ | - |
| ç«çƒæœ¯ | ä¸»åŠ¨ | 150%æ”»å‡»ä¼¤å®³ | 3ç§’ |
| æš´å‡» | è¢«åŠ¨ | 15%å‡ ç‡åŒå€ä¼¤å®³ | - |

### 4.3 å‡çº§å¯é€‰æŠ€èƒ½

| ç¨€æœ‰åº¦ | æŠ€èƒ½å | æ•ˆæœ |
|--------|--------|------|
| æ™®é€š | ç«çƒæœ¯å¼ºåŒ– | ä¼¤å®³+20% |
| æ™®é€š | æš´å‡»ç²¾é€š | æš´å‡»ç‡+5% |
| æ™®é€š | ç”Ÿå‘½å›å¤ | å›å¤30%HP |
| æ™®é€š | åŠ›é‡æå‡ | åŸºç¡€æ”»å‡»+10% |
| ç¨€æœ‰ | é“å£ | å—ä¼¤-10% |
| ç¨€æœ‰ | æ€¥é€Ÿ | æ”»å‡»é€Ÿåº¦+15% |
| å²è¯— | ç”Ÿå‘½å·å– | æ”»å‡»å›å¤5%HP |
| å²è¯— | è¿å‡» | 10%å‡ ç‡æ”»å‡»ä¸¤æ¬¡ |
| ä¼ è¯´ | ç‹‚æš´ | HP<30%æ—¶ä¼¤å®³+50% |

---

## 5. è§†è§‰è¡¨ç°

### 5.1 è¡€æ¡ç³»ç»Ÿ

```typescript
interface HealthBar {
  // æ˜¾ç¤ºä½ç½®
  position: 'above' | 'below';  // è§’è‰²ä¸Šæ–¹/ä¸‹æ–¹
  
  // è§†è§‰æ•ˆæœ
  width: number;      // å®½åº¦
  height: number;     // é«˜åº¦
  bgColor: string;    // èƒŒæ™¯è‰²
  hpColor: string;    // è¡€é‡è‰²ï¼ˆçº¢ï¼‰
  lowHpColor: string; // ä½è¡€é‡è‰²ï¼ˆé—ªçº¢ï¼‰
  lowHpThreshold: number; // ä½è¡€é‡é˜ˆå€¼ï¼ˆ0.3ï¼‰
  
  // åŠ¨ç”»
  smoothTransition: boolean;  // å¹³æ»‘è¿‡æ¸¡
  animationDuration: number;  // åŠ¨ç”»æ—¶é•¿ï¼ˆmsï¼‰
  
  // ä¼¤å®³æ•°å­—
  showDamageNumber: boolean;
  damageNumberDuration: number;
  damageNumberColor: {
    normal: string;   // æ™®é€šä¼¤å®³ï¼ˆç™½ï¼‰
    crit: string;     // æš´å‡»ï¼ˆæ©™ï¼‰
    heal: string;     // å›å¤ï¼ˆç»¿ï¼‰
  };
}
```

### 5.2 æˆ˜æ–—åŠ¨ç”»

```typescript
interface BattleAnimations {
  // è‹±é›„æ”»å‡»
  heroAttack: {
    type: 'tween';
    targets: ['hero'];
    moveTo: { x: targetX - 50 };
    duration: 100;
    yoyo: true;
  };
  
  // æ•Œäººæ”»å‡»
  enemyAttack: {
    type: 'tween';
    targets: ['enemy'];
    moveTo: { x: heroX + 50 };
    duration: 100;
    yoyo: true;
  };
  
  // å—ä¼¤
  takeDamage: {
    type: 'tween';
    targets: ['target'];
    tint: 0xff0000;
    duration: 100;
    yoyo: true;
  };
  
  // æ­»äº¡
  death: {
    type: 'tween';
    targets: ['target'];
    alpha: 0;
    scale: 1.5;
    duration: 300;
  };
}
```

### 5.3 UIå¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ç¬¬ X å…³          ğŸ’°100  âš¡50   â”‚ â”‚  â† é¡¶éƒ¨ä¿¡æ¯æ 
â”‚  â”‚ HP â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 100/120          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                      â”‚
â”‚                                      â”‚
â”‚      ğŸ§™  â†â”€â”€â”€â”€â”€â”€æˆ˜æ–—åŒºåŸŸâ”€â”€â”€â”€â”€â”€â†’  ğŸ‘º  â”‚  â† æˆ˜æ–—åŒºåŸŸ
â”‚                    ğŸ©¸-50            â”‚  â† ä¼¤å®³æ•°å­—
â”‚                                      â”‚
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸ”¥ ç«çƒæœ¯é€ æˆ75ä¼¤å®³ï¼            â”‚ â”‚  â† æˆ˜æ–—æ—¥å¿—
â”‚  â”‚ ğŸ’¥ æš´å‡»ï¼                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                      â”‚
â”‚  [ğŸ è¿”å›]              [ğŸ¤–è‡ªåŠ¨]     â”‚  â† æ§åˆ¶æŒ‰é’®
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. æ•°æ®æŒä¹…åŒ–

### 6.1 å†’é™©æ•°æ®ï¼ˆRunDataï¼‰

```typescript
interface RunData {
  runId: string;
  heroId: string;
  heroLevel: number;
  
  // å½“å‰çŠ¶æ€
  currentLevel: number;
  currentHp: number;
  maxHp: number;
  
  // è·å¾—å¥–åŠ±
  skills: Skill[];
  equipment: Equipment[];
  gold: number;
  exp: number;
  
  // å…ƒæ•°æ®
  startTime: number;
  status: 'ongoing' | 'completed' | 'failed';
  levelsCompleted: number[];
}
```

### 6.2 åœºæ™¯åˆ‡æ¢æ•°æ®æµ

```
MainScene â†’ BattleScene
  â†“
  data: { continue: boolean }
  â†“
  if (continue) â†’ ä» RunData æ¢å¤
  else â†’ åˆå§‹åŒ–æ–°æˆ˜æ–—
```

---

## 7. é—®é¢˜ä¸æ”¹è¿›

### 7.1 å½“å‰é—®é¢˜

1. **ç¬¬äºŒåœºæˆ˜æ–—æ— æ³•è¿›è¡Œ**
   - åŸå› ï¼šçŠ¶æ€æœªå®Œå…¨é‡ç½®
   - è§£å†³ï¼šåœ¨ init() ä¸­é‡ç½®æ‰€æœ‰å˜é‡

2. **è¡€é‡å˜åŒ–æ— åŠ¨ç”»**
   - åŸå› ï¼šåªæœ‰æ–‡å­—æ—¥å¿—ï¼Œæ²¡æœ‰è§†è§‰åé¦ˆ
   - è§£å†³ï¼šæ·»åŠ è¡€æ¡åŠ¨ç”»ã€ä¼¤å®³æ•°å­—é£˜å­—

3. **æˆ˜æ–—èŠ‚å¥å•è°ƒ**
   - åŸå› ï¼šåªæœ‰æ™®æ”»å’ŒæŠ€èƒ½
   - è§£å†³ï¼šæ·»åŠ æ›´å¤šæŠ€èƒ½ç±»å‹ã€æ•ŒäººAI

### 7.2 æ”¹è¿›è®¡åˆ’

#### é˜¶æ®µ1ï¼šåŸºç¡€ä½“éªŒï¼ˆæœ¬å‘¨ï¼‰
- [ ] ä¿®å¤è¿ç»­æˆ˜æ–—Bug
- [ ] æ·»åŠ è¡€æ¡åŠ¨ç”»
- [ ] æ·»åŠ ä¼¤å®³æ•°å­—é£˜å­—
- [ ] ä¼˜åŒ–æˆ˜æ–—æ—¥å¿—æ˜¾ç¤º

#### é˜¶æ®µ2ï¼šä¸°å¯Œå†…å®¹ï¼ˆä¸‹å‘¨ï¼‰
- [ ] æ·»åŠ 5ç§è‹±é›„
- [ ] æ·»åŠ 20ç§æŠ€èƒ½
- [ ] æ·»åŠ Bossæˆ˜
- [ ] æ·»åŠ è£…å¤‡æ‰è½

#### é˜¶æ®µ3ï¼šç­–ç•¥æ·±åº¦ï¼ˆåç»­ï¼‰
- [ ] æ·»åŠ å¤©èµ‹ç³»ç»Ÿ
- [ ] æ·»åŠ è£…å¤‡ç³»ç»Ÿ
- [ ] æ·»åŠ éš¾åº¦é€‰æ‹©
- [ ] æ·»åŠ æˆå°±ç³»ç»Ÿ

---

## 8. æŠ€æœ¯å®ç°

### 8.1 æ–‡ä»¶ç»“æ„

```
src/
â”œâ”€â”€ scenes/
â”‚   â””â”€â”€ BattleScene.ts      # æˆ˜æ–—åœºæ™¯
â”œâ”€â”€ systems/
â”‚   â”œâ”€â”€ BattleSystem.ts     # æˆ˜æ–—é€»è¾‘
â”‚   â”œâ”€â”€ SkillSystem.ts      # æŠ€èƒ½ç³»ç»Ÿ
â”‚   â””â”€â”€ AnimationSystem.ts  # åŠ¨ç”»ç³»ç»Ÿ
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ skills.ts           # æŠ€èƒ½æ•°æ®
â”‚   â””â”€â”€ enemies.ts          # æ•Œäººæ•°æ®
â””â”€â”€ utils/
    â””â”€â”€ DataManager.ts      # æ•°æ®ç®¡ç†
```

### 8.2 å…³é”®ä»£ç 

```typescript
// æˆ˜æ–—åˆå§‹åŒ–
init(data: { continue: boolean }) {
  // é‡ç½®æ‰€æœ‰çŠ¶æ€
  this.currentLevel = 1;
  this.heroHp = 100;
  this.heroMaxHp = 100;
  this.gold = 0;
  this.exp = 0;
  this.skills = [];
  this.enemies = [];
  this.battleLog = [];
  this.isPaused = false;
  
  // ä»å­˜æ¡£æ¢å¤
  if (data.continue) {
    const run = DataManager.getCurrentRun();
    if (run) { /* æ¢å¤æ•°æ® */ }
  }
}
```

---

## 9. å¾…è®¨è®ºé—®é¢˜

1. **æˆ˜æ–—èŠ‚å¥æ˜¯å¦å¤ªå¿«/å¤ªæ…¢ï¼Ÿ**
   - å½“å‰ï¼šæ¯ç§’ä¸€ä¸ªå›åˆ
   - å¯é€‰ï¼š1.5ç§’/å›åˆï¼Œæˆ–æ ¹æ®æ”»é€Ÿè°ƒæ•´

2. **è‡ªåŠ¨/æ‰‹åŠ¨æ¨¡å¼å¦‚ä½•å¹³è¡¡ï¼Ÿ**
   - å½“å‰ï¼šæ‰‹åŠ¨åªèƒ½æ§åˆ¶æŠ€èƒ½é‡Šæ”¾æ—¶æœº
   - å¯é€‰ï¼šæ‰‹åŠ¨æ—¶å¯ä»¥èµ°ä½ã€é€‰æ‹©ç›®æ ‡

3. **è¡€æ¡æ˜¾ç¤ºä½ç½®ï¼Ÿ**
   - å½“å‰ï¼šåªæœ‰UIæ æ˜¾ç¤º
   - å¯é€‰ï¼šè§’è‰²å¤´é¡¶ä¹Ÿæ˜¾ç¤ºè¡€æ¡

4. **ä¼¤å®³æ•°å­—æ ·å¼ï¼Ÿ**
   - å½“å‰ï¼šæ— 
   - å¯é€‰ï¼šé£˜å­—ã€è·³åŠ¨ã€é¢œè‰²åŒºåˆ†

---

*æ–‡æ¡£ç‰ˆæœ¬ï¼šv1.0*
*æœ€åæ›´æ–°ï¼š2026-02-16*
