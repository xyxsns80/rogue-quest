<!DOCTYPE html>
<html>
<head>
  <title>Rogue Quest - ç¾ç»Šç³»ç»Ÿå•å…ƒæµ‹è¯•</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
    .test-pass { background: #e8f5e9; border-left: 4px solid #4caf50; padding: 10px; margin: 5px 0; }
    .test-fail { background: #ffebee; border-left: 4px solid #f44336; padding: 10px; margin: 5px 0; }
    h2 { margin-top: 20px; }
    #results { margin-top: 20px; }
    .summary { font-size: 18px; font-weight: bold; padding: 15px; margin: 10px 0; border-radius: 4px; }
  </style>
</head>
<body>
  <h1>ğŸ§ª Rogue Quest - ç¾ç»Šç³»ç»Ÿå•å…ƒæµ‹è¯•</h1>
  <button onclick="runAllTests()">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
  <div id="results"></div>

  <script type="module">
    // å¤åˆ¶æ ¸å¿ƒé€»è¾‘è¿›è¡Œæµ‹è¯•
    const SYNERGY_LEVELS = {
      2: { required: 2, bonus: { attack: 0.05, defense: 0.05 } },
      3: { required: 3, bonus: { attack: 0.10, defense: 0.10 } },
      4: { required: 4, bonus: { attack: 0.15, defense: 0.15, hp: 0.10 } },
      5: { required: 5, bonus: { attack: 0.20, defense: 0.20, hp: 0.15 } },
      7: { required: 7, bonus: { attack: 0.30, defense: 0.30, hp: 0.25, special: 'ultimate' } },
    };

    // ä¿®å¤åçš„å‡½æ•°
    function getSynergyLevel(count) {
      if (count >= 7) return 7;
      if (count >= 5) return 5;
      if (count >= 4) return 4;
      if (count >= 3) return 3;
      if (count >= 2) return 2;
      return 0;
    }

    // ä¿®å¤å‰çš„å‡½æ•°ï¼ˆç”¨äºå¯¹æ¯”ï¼‰
    function getSynergyLevelOld(count) {
      if (count >= 7) return 5;
      if (count >= 5) return 4;
      if (count >= 4) return 3;
      if (count >= 3) return 2;
      if (count >= 2) return 1;
      return 0;
    }

    let passCount = 0;
    let failCount = 0;

    function log(message, pass) {
      const div = document.createElement('div');
      div.className = pass ? 'test-pass' : 'test-fail';
      div.innerHTML = message;
      document.getElementById('results').appendChild(div);
      if (pass) passCount++;
      else failCount++;
    }

    function logSection(title) {
      const h2 = document.createElement('h2');
      h2.textContent = title;
      document.getElementById('results').appendChild(h2);
    }

    window.runAllTests = function() {
      document.getElementById('results').innerHTML = '';
      passCount = 0;
      failCount = 0;

      // æµ‹è¯•1: ç¾ç»Šç­‰çº§æ˜ å°„
      logSection('æµ‹è¯•1: ç¾ç»Šç­‰çº§æ˜ å°„');

      const tests = [
        { count: 1, expected: 0 },
        { count: 2, expected: 2 },
        { count: 3, expected: 3 },
        { count: 4, expected: 4 },
        { count: 5, expected: 5 },
        { count: 6, expected: 5 },
        { count: 7, expected: 7 },
        { count: 8, expected: 7 },
        { count: 10, expected: 7 },
      ];

      tests.forEach(test => {
        const result = getSynergyLevel(test.count);
        const pass = result === test.expected;
        log(`count=${test.count} â†’ level=${result} (æœŸæœ› ${test.expected}) ${pass ? 'âœ“' : 'âœ—'}`, pass);
      });

      // æµ‹è¯•2: SYNERGY_LEVELS é”®å­˜åœ¨æ€§
      logSection('æµ‹è¯•2: SYNERGY_LEVELS é”®å­˜åœ¨æ€§');

      [2, 3, 4, 5, 7].forEach(level => {
        const exists = SYNERGY_LEVELS[level] !== undefined;
        log(`SYNERGY_LEVELS[${level}] å­˜åœ¨: ${exists ? 'âœ“' : 'âœ—'}`, exists);
      });

      // æµ‹è¯•3: å®Œæ•´ç¾ç»Šè®¡ç®—æµç¨‹
      logSection('æµ‹è¯•3: å®Œæ•´ç¾ç»Šè®¡ç®—æµç¨‹');

      [2, 3, 4, 5, 7].forEach(count => {
        const level = getSynergyLevel(count);
        const config = SYNERGY_LEVELS[level];
        if (config) {
          const bonus = config.bonus;
          log(`${count}ä¸ªåŒç§æ— â†’ ç­‰çº§${level} â†’ æ”»å‡»+${bonus.attack*100}%, é˜²å¾¡+${bonus.defense*100}% âœ“`, true);
        } else {
          log(`${count}ä¸ªåŒç§æ— â†’ ç­‰çº§${level} â†’ SYNERGY_LEVELS[${level}] ä¸å­˜åœ¨ âœ—`, false);
        }
      });

      // æµ‹è¯•4: æ—§å‡½æ•°çš„é—®é¢˜
      logSection('æµ‹è¯•4: æ—§å‡½æ•°çš„é—®é¢˜ï¼ˆå¯¹æ¯”ï¼‰');

      log(`æ—§å‡½æ•° getSynergyLevel(2) â†’ ${getSynergyLevelOld(2)} â†’ SYNERGY_LEVELS[${getSynergyLevelOld(2)}] = ${SYNERGY_LEVELS[getSynergyLevelOld(2)]} âœ— (è¿™æ˜¯ bug!)`, false);
      log(`æ–°å‡½æ•° getSynergyLevel(2) â†’ ${getSynergyLevel(2)} â†’ SYNERGY_LEVELS[${getSynergyLevel(2)}] = ${JSON.stringify(SYNERGY_LEVELS[getSynergyLevel(2)])} âœ“`, true);

      // æ€»ç»“
      const summary = document.createElement('div');
      summary.className = 'summary';
      summary.style.background = failCount === 0 ? '#e8f5e9' : '#fff3e0';
      summary.innerHTML = `æµ‹è¯•å®Œæˆ: ${passCount} é€šè¿‡, ${failCount} å¤±è´¥`;
      document.getElementById('results').insertBefore(summary, document.getElementById('results').firstChild);
    };
  </script>
</body>
</html>
