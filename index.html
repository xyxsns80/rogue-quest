<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <title>è‚‰é¸½å¾é€”</title>
  <style>
    /* ========== CSS å˜é‡ - è‡ªé€‚åº”è®¾è®¡ç³»ç»Ÿ ========== */
    :root {
      /* é¢œè‰² */
      --bg-primary: #1a1a2e;
      --bg-secondary: rgba(22, 33, 62, 0.95);
      --accent: #667eea;
      --accent-light: rgba(102, 126, 234, 0.3);
      --gold: #ffd700;
      --green: #4CAF50;
      --orange: #ff9800;
      --text-primary: #ffffff;
      --text-secondary: #888888;
      
      /* å®‰å…¨åŒºåŸŸ - é€‚é…åˆ˜æµ·å± */
      --safe-top: env(safe-area-inset-top, 0px);
      --safe-bottom: env(safe-area-inset-bottom, 0px);
      --safe-left: env(safe-area-inset-left, 0px);
      --safe-right: env(safe-area-inset-right, 0px);
      
      /* é—´è· */
      --spacing-xs: 4px;
      --spacing-sm: 8px;
      --spacing-md: 12px;
      --spacing-lg: 16px;
      --spacing-xl: 20px;
      
      /* å°ºå¯¸ */
      --top-bar-height: 60px;
      --bottom-nav-height: 60px;
      --button-height: 50px;
      --border-radius: 12px;
    }
    
    /* ========== åŸºç¡€æ ·å¼ ========== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    
    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: var(--bg-primary);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      touch-action: manipulation;
    }
    
    /* ========== æ¸¸æˆç”»å¸ƒå®¹å™¨ ========== */
    #game {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
    }
    
    #game canvas {
      display: block;
      width: 100% !important;
      height: 100% !important;
    }
    
    /* ========== UI å®¹å™¨ - ä½¿ç”¨ Flexbox ========== */
    .ui-container {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 10;
      display: none;
      flex-direction: column;
      pointer-events: none;
    }
    
    .ui-container.active {
      display: flex;
    }
    
    /* ========== ä¸»ç•Œé¢å¸ƒå±€ ========== */
    #main-ui {
      /* é¡¶éƒ¨ä¿¡æ¯æ  */
      /* ä¸­é—´å†…å®¹åŒº */
      /* åº•éƒ¨å¯¼èˆª */
    }
    
    /* é¡¶éƒ¨ä¿¡æ¯æ  - å›ºå®šé«˜åº¦ï¼ŒFlexbox æ¨ªå‘å¸ƒå±€ */
    .top-bar {
      flex-shrink: 0;
      height: calc(var(--top-bar-height) + var(--safe-top));
      padding-top: var(--safe-top);
      padding-left: calc(var(--spacing-lg) + var(--safe-left));
      padding-right: calc(var(--spacing-lg) + var(--safe-right));
      background: linear-gradient(180deg, var(--bg-secondary) 0%, rgba(22, 33, 62, 0.8) 100%);
      display: flex;
      justify-content: space-between;
      align-items: center;
      pointer-events: auto;
    }
    
    .player-info {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-xs);
    }
    
    .player-name {
      color: var(--text-primary);
      font-size: 14px;
      font-weight: 500;
    }
    
    .player-level {
      color: #7fff7f;
      font-size: 12px;
    }
    
    .resources {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: var(--spacing-xs);
    }
    
    .gold {
      color: var(--gold);
      font-size: 14px;
      font-weight: 500;
    }
    
    .diamond {
      color: #87ceeb;
      font-size: 12px;
    }
    
    /* ä¸­é—´å†…å®¹åŒº - å¼¹æ€§å¡«å…… */
    .content-area {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: var(--spacing-lg);
      gap: var(--spacing-xl);
      overflow: hidden;
    }
    
    /* å¼€å§‹å†’é™©æŒ‰é’® - å±…ä¸­ï¼Œå“åº”å¼å®½åº¦ */
    .adventure-btn {
      width: min(85%, 320px);
      min-height: var(--button-height);
      padding: var(--spacing-lg);
      background: linear-gradient(135deg, var(--accent-light) 0%, rgba(118, 75, 162, 0.3) 100%);
      border: 3px solid var(--accent);
      border-radius: var(--border-radius);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      pointer-events: auto;
      transition: all 0.15s ease;
      -webkit-user-select: none;
      user-select: none;
    }
    
    .adventure-btn:active {
      transform: scale(0.96);
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.5) 0%, rgba(118, 75, 162, 0.5) 100%);
    }
    
    .adventure-btn .title {
      color: var(--gold);
      font-size: clamp(18px, 5vw, 24px);
      font-weight: bold;
    }
    
    .adventure-btn .subtitle {
      color: var(--text-secondary);
      font-size: 12px;
      margin-top: var(--spacing-sm);
    }
    
    /* åŠŸèƒ½æŒ‰é’®ç½‘æ ¼ - å“åº”å¼ */
    .button-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: var(--spacing-md);
      width: min(90%, 350px);
      pointer-events: auto;
    }
    
    .func-btn {
      aspect-ratio: 1;
      min-height: 60px;
      background: rgba(102, 126, 234, 0.2);
      border: 2px solid var(--accent);
      border-radius: var(--border-radius);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      transition: all 0.15s ease;
      -webkit-user-select: none;
      user-select: none;
    }
    
    .func-btn:active {
      background: rgba(102, 126, 234, 0.4);
      transform: scale(0.95);
    }
    
    .func-btn .icon {
      font-size: clamp(20px, 6vw, 28px);
    }
    
    .func-btn .name {
      color: var(--text-primary);
      font-size: clamp(10px, 3vw, 12px);
      margin-top: var(--spacing-xs);
    }
    
    .func-btn.secondary {
      background: rgba(68, 68, 68, 0.5);
      border-color: #666;
    }
    
    .func-btn.secondary .name {
      color: #aaa;
    }
    
    /* æ”¾ç½®æ”¶ç›ŠåŒº - åº•éƒ¨å¯¼èˆªä¸Šæ–¹ */
    .idle-section {
      flex-shrink: 0;
      margin: var(--spacing-lg);
      margin-bottom: calc(var(--spacing-lg) + var(--safe-bottom));
      padding: var(--spacing-md);
      background: var(--bg-secondary);
      border-radius: var(--border-radius);
      display: flex;
      flex-direction: column;
      align-items: center;
      pointer-events: auto;
      gap: var(--spacing-xs);
    }
    
    .idle-title {
      color: var(--text-secondary);
      font-size: 12px;
    }
    
    .idle-rate {
      color: var(--gold);
      font-size: 14px;
      font-weight: 500;
    }
    
    .idle-accumulated {
      color: var(--text-primary);
      font-size: 12px;
    }
    
    .idle-buttons {
      display: flex;
      gap: var(--spacing-lg);
      margin-top: var(--spacing-sm);
    }
    
    .idle-btn {
      width: 90px;
      height: 32px;
      border: none;
      border-radius: 8px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.15s ease;
      -webkit-user-select: none;
      user-select: none;
    }
    
    .idle-btn.collect {
      background: var(--green);
      color: var(--text-primary);
    }
    
    .idle-btn.speed {
      background: var(--orange);
      color: var(--text-primary);
    }
    
    .idle-btn:active {
      transform: scale(0.95);
    }
    
    /* åº•éƒ¨å¯¼èˆª - å›ºå®šé«˜åº¦ */
    .bottom-nav {
      flex-shrink: 0;
      height: calc(var(--bottom-nav-height) + var(--safe-bottom));
      padding-bottom: var(--safe-bottom);
      background: var(--bg-secondary);
      display: flex;
      justify-content: space-around;
      align-items: center;
      pointer-events: auto;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      cursor: pointer;
      padding: var(--spacing-sm);
      -webkit-user-select: none;
      user-select: none;
    }
    
    .nav-item .icon {
      font-size: 20px;
    }
    
    .nav-item .name {
      color: var(--text-secondary);
      font-size: 10px;
      margin-top: var(--spacing-xs);
    }
    
    /* ========== Toast æç¤º ========== */
    .toast {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.85);
      color: var(--text-primary);
      padding: var(--spacing-md) var(--spacing-xl);
      border-radius: 8px;
      font-size: 14px;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 1000;
      max-width: 80%;
      text-align: center;
    }
    
    .toast.show {
      opacity: 1;
    }
    
    /* ========== ç™»å½•ç•Œé¢ ========== */
    #login-ui {
      justify-content: center;
      align-items: center;
      padding: var(--spacing-xl);
    }
    
    .login-logo {
      font-size: 64px;
      margin-bottom: var(--spacing-md);
    }
    
    .login-title {
      color: var(--gold);
      font-size: clamp(28px, 8vw, 36px);
      font-weight: bold;
      margin-bottom: var(--spacing-sm);
    }
    
    .login-version {
      color: var(--text-secondary);
      font-size: 14px;
      margin-bottom: var(--spacing-xl);
    }
    
    .login-form {
      width: min(90%, 300px);
      display: flex;
      flex-direction: column;
      gap: var(--spacing-md);
      pointer-events: auto;
    }
    
    .login-input {
      width: 100%;
      height: 44px;
      padding: 0 var(--spacing-md);
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid var(--accent);
      border-radius: 8px;
      color: var(--text-primary);
      font-size: 16px;
      outline: none;
      transition: border-color 0.2s;
    }
    
    .login-input:focus {
      border-color: var(--gold);
    }
    
    .login-input::placeholder {
      color: var(--text-secondary);
    }
    
    .login-btn {
      width: 100%;
      height: 50px;
      background: linear-gradient(135deg, var(--accent), #764ba2);
      border: none;
      border-radius: 8px;
      color: var(--text-primary);
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.15s ease;
    }
    
    .login-btn:active {
      transform: scale(0.98);
    }
    
    .login-hint {
      color: var(--text-secondary);
      font-size: 12px;
      text-align: center;
      margin-top: var(--spacing-md);
    }
    
    .login-error {
      color: #ff4444;
      font-size: 14px;
      text-align: center;
      min-height: 20px;
    }
    
    /* ========== æˆ˜æ–—ç•Œé¢ UI ========== */
    #battle-ui {
      flex-direction: column;
    }
    
    .battle-top-bar {
      flex-shrink: 0;
      height: calc(var(--top-bar-height) + var(--safe-top));
      padding-top: var(--safe-top);
      padding-left: calc(var(--spacing-lg) + var(--safe-left));
      padding-right: calc(var(--spacing-lg) + var(--safe-right));
      background: var(--bg-secondary);
      display: flex;
      justify-content: space-between;
      align-items: center;
      pointer-events: auto;
    }
    
    .battle-info {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-xs);
    }
    
    .battle-level {
      color: var(--gold);
      font-size: 18px;
      font-weight: bold;
    }
    
    .battle-hp-bar {
      width: 120px;
      height: 8px;
      background: #333;
      border-radius: 4px;
      overflow: hidden;
    }
    
    .battle-hp-fill {
      height: 100%;
      background: #ff4444;
      transition: width 0.3s ease;
    }
    
    .battle-hp-text {
      color: var(--text-primary);
      font-size: 10px;
      margin-top: 2px;
    }
    
    .battle-stats {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: var(--spacing-xs);
    }
    
    .battle-gold, .battle-exp {
      font-size: 14px;
    }
    
    .battle-gold {
      color: var(--gold);
    }
    
    .battle-exp {
      color: #7fff7f;
    }
    
    /* æˆ˜æ–—åŒºåŸŸ - ä¸­é—´ Canvas */
    .battle-canvas-area {
      flex: 1;
      position: relative;
    }
    
    /* æˆ˜æ–—åº•éƒ¨æ§åˆ¶ */
    .battle-bottom {
      flex-shrink: 0;
      padding: var(--spacing-md);
      padding-bottom: calc(var(--spacing-md) + var(--safe-bottom));
      background: var(--bg-secondary);
      pointer-events: auto;
    }
    
    .battle-log {
      height: 60px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
      padding: var(--spacing-sm);
      margin-bottom: var(--spacing-md);
      overflow: hidden;
    }
    
    .battle-log-text {
      color: var(--text-secondary);
      font-size: 11px;
      line-height: 1.4;
    }
    
    .battle-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .battle-back-btn {
      width: 80px;
      height: 36px;
      background: #666;
      border: none;
      border-radius: 8px;
      color: var(--text-primary);
      font-size: 12px;
      cursor: pointer;
    }
    
    .battle-mode {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      color: var(--green);
      font-size: 12px;
    }
    
    /* ========== æŠ€èƒ½é€‰æ‹©å¼¹çª— ========== */
    #skill-select-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 100;
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: rgba(0, 0, 0, 0.8);
      pointer-events: auto;
    }
    
    #skill-select-overlay.active {
      display: flex;
    }
    
    .skill-select-title {
      color: var(--gold);
      font-size: clamp(20px, 6vw, 28px);
      font-weight: bold;
      margin-bottom: var(--spacing-xl);
      text-align: center;
    }
    
    .skill-select-subtitle {
      color: var(--text-secondary);
      font-size: 14px;
      margin-bottom: var(--spacing-lg);
    }
    
    .skill-options {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-md);
      width: min(90%, 320px);
    }
    
    .skill-option {
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
      padding: var(--spacing-md);
      background: rgba(102, 126, 234, 0.2);
      border: 2px solid var(--accent);
      border-radius: var(--border-radius);
      cursor: pointer;
      transition: all 0.15s ease;
      -webkit-user-select: none;
      user-select: none;
    }
    
    .skill-option:active {
      background: rgba(102, 126, 234, 0.4);
      transform: scale(0.98);
    }
    
    .skill-option-icon {
      font-size: 36px;
      flex-shrink: 0;
    }
    
    .skill-option-info {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: var(--spacing-xs);
    }
    
    .skill-option-name {
      color: var(--text-primary);
      font-size: 16px;
      font-weight: 500;
    }
    
    .skill-option-desc {
      color: var(--text-secondary);
      font-size: 12px;
    }
    
    .skill-option-rarity {
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 4px;
      align-self: flex-start;
    }
    
    .skill-option-rarity.common {
      background: #666;
      color: #fff;
    }
    
    .skill-option-rarity.rare {
      background: #4a90d9;
      color: #fff;
    }
    
    .skill-option-rarity.epic {
      background: #a335ee;
      color: #fff;
    }
    
    .skill-option-rarity.legendary {
      background: #ff8000;
      color: #fff;
    }
    
    /* ========== å…³å¡ç»“æŸç•Œé¢ ========== */
    #level-complete-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 100;
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: rgba(0, 0, 0, 0.85);
      pointer-events: auto;
    }
    
    #level-complete-overlay.active {
      display: flex;
    }
    
    .level-rewards {
      background: rgba(255, 255, 255, 0.1);
      padding: var(--spacing-md) var(--spacing-xl);
      border-radius: 8px;
      margin: var(--spacing-md) 0;
      text-align: center;
    }
    
    .reward-summary {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-xs);
      color: var(--text-primary);
      font-size: 14px;
    }
    
    .reward-summary span {
      color: var(--gold);
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div id="game"></div>
  
  <!-- ç™»å½•ç•Œé¢ -->
  <div id="login-ui" class="ui-container">
    <div class="login-logo">ğŸ†</div>
    <div class="login-title">è‚‰é¸½å¾é€”</div>
    <div class="login-version">v1.0</div>
    <div class="login-form">
      <input type="text" class="login-input" id="login-username" placeholder="è´¦å·" autocomplete="off">
      <input type="password" class="login-input" id="login-password" placeholder="å¯†ç ">
      <button class="login-btn" id="login-btn">ç™»å½• / æ³¨å†Œ</button>
      <div class="login-hint">é¦–æ¬¡è¾“å…¥è‡ªåŠ¨æ³¨å†Œï¼Œå†æ¬¡è¾“å…¥è‡ªåŠ¨ç™»å½•</div>
      <div class="login-error" id="login-error"></div>
    </div>
  </div>
  
  <!-- ä¸»ç•Œé¢ -->
  <div id="main-ui" class="ui-container">
    <!-- é¡¶éƒ¨ä¿¡æ¯æ  -->
    <div class="top-bar">
      <div class="player-info">
        <div class="player-name">ğŸ‘¤ <span id="player-name">ç©å®¶</span></div>
        <div class="player-level">LV.<span id="player-level">1</span></div>
      </div>
      <div class="resources">
        <div class="gold">ğŸ’° <span id="gold">0</span></div>
        <div class="diamond">ğŸ’ <span id="diamond">0</span></div>
      </div>
    </div>
    
    <!-- ä¸­é—´å†…å®¹åŒº -->
    <div class="content-area">
      <!-- å¼€å§‹å†’é™©æŒ‰é’® -->
      <div class="adventure-btn" id="adventure-btn">
        <div class="title">âš”ï¸ å¼€å§‹å†’é™©</div>
        <div class="subtitle" id="adventure-subtitle">æ¨èç­‰çº§: â˜…</div>
      </div>
      
      <!-- å…»æˆå…¥å£ -->
      <div class="button-grid">
        <div class="func-btn" data-action="hero">
          <div class="icon">ğŸ¦¸</div>
          <div class="name">è‹±é›„</div>
        </div>
        <div class="func-btn" data-action="talent">
          <div class="icon">ğŸŒŸ</div>
          <div class="name">å¤©èµ‹</div>
        </div>
        <div class="func-btn" data-action="equipment">
          <div class="icon">âš”ï¸</div>
          <div class="name">è£…å¤‡</div>
        </div>
        <div class="func-btn secondary" data-action="task">
          <div class="icon">ğŸ“‹</div>
          <div class="name">ä»»åŠ¡</div>
        </div>
        <div class="func-btn secondary" data-action="shop">
          <div class="icon">ğŸª</div>
          <div class="name">å•†åº—</div>
        </div>
        <div class="func-btn secondary" data-action="collection">
          <div class="icon">ğŸ“–</div>
          <div class="name">å›¾é‰´</div>
        </div>
      </div>
    </div>
    
    <!-- æ”¾ç½®æ”¶ç›Š -->
    <div class="idle-section">
      <div class="idle-title">ğŸ’° æŒ‚æœºæ”¶ç›Š</div>
      <div class="idle-rate">+<span id="idle-rate">10</span>/å°æ—¶</div>
      <div class="idle-accumulated">å·²ç´¯ç§¯: <span id="idle-accumulated">0</span></div>
      <div class="idle-buttons">
        <button class="idle-btn collect" id="collect-btn">ğŸ“¦ é¢†å–</button>
        <button class="idle-btn speed" id="speed-btn">âš¡ åŠ é€Ÿ</button>
      </div>
    </div>
  </div>
  
  <!-- æˆ˜æ–—ç•Œé¢ UI -->
  <div id="battle-ui" class="ui-container">
    <div class="battle-top-bar">
      <div class="battle-info">
        <div class="battle-level" id="battle-level">ç¬¬ 1 å…³</div>
        <div class="battle-hp-bar">
          <div class="battle-hp-fill" id="battle-hp-fill" style="width: 100%"></div>
        </div>
        <div class="battle-hp-text" id="battle-hp-text">HP: 100/100</div>
      </div>
      <div class="battle-stats">
        <div class="battle-gold">ğŸ’° <span id="battle-gold">0</span></div>
        <div class="battle-exp">âš¡ <span id="battle-exp">0</span></div>
      </div>
    </div>
    
    <div class="battle-canvas-area">
      <!-- Phaser Canvas åœ¨è¿™é‡Œæ˜¾ç¤º -->
    </div>
    
    <div class="battle-bottom">
      <div class="battle-log">
        <div class="battle-log-text" id="battle-log-text">æˆ˜æ–—å¼€å§‹...</div>
      </div>
      <div class="battle-controls">
        <button class="battle-back-btn" id="battle-back">ğŸ  è¿”å›</button>
        <div class="battle-mode" id="battle-mode">ğŸ¤– è‡ªåŠ¨</div>
      </div>
    </div>
  </div>
  
  <!-- æŠ€èƒ½é€‰æ‹©å¼¹çª— -->
  <div id="skill-select-overlay">
    <div class="skill-select-title">ğŸ‰ å‡çº§ï¼é€‰æ‹©å¥–åŠ±</div>
    <div class="skill-select-subtitle" id="skill-select-level">è¾¾åˆ°ç­‰çº§ 2</div>
    <div class="skill-options" id="skill-options">
      <!-- åŠ¨æ€ç”ŸæˆæŠ€èƒ½é€‰é¡¹ -->
    </div>
  </div>
  
  <!-- å…³å¡ç»“æŸè‚‰é¸½é€‰æ‹© -->
  <div id="level-complete-overlay">
    <div class="skill-select-title">ğŸ† å…³å¡é€šè¿‡ï¼</div>
    <div class="skill-select-subtitle" id="level-complete-text">ç¬¬ 1 å…³å®Œæˆ</div>
    <div class="level-rewards" id="level-rewards">
      <div class="reward-summary">
        <div>ğŸ’° è·å¾—: <span id="level-gold">0</span></div>
        <div>âš¡ ç»éªŒ: <span id="level-exp">0</span></div>
      </div>
    </div>
    <div class="skill-select-title" style="font-size: 18px; margin-top: 16px;">é€‰æ‹©å¥–åŠ±</div>
    <div class="skill-options" id="level-skill-options">
      <!-- åŠ¨æ€ç”Ÿæˆ -->
    </div>
  </div>
  
  <!-- Toast -->
  <div class="toast" id="toast"></div>
  
  <script type="module" src="/src/main.ts"></script>
</body>
</html>
